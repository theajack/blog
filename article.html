<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="keywords" content="">  
    <meta name="description" content="">  
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <meta http-equiv="X-UA-Compatible" content="IE=8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1"/>
    <title>一步步理解和使用JSONP--(Blog theajack)</title>
    <link rel="stylesheet" type="text/css" href="assets/css/glyphicon.css"/>
    <link rel="stylesheet" type="text/css" href="assets/css/index.css"/>
    <link rel="stylesheet" type="text/css" href="assets/css/article.css"/>
    <link rel="stylesheet" type="text/css" href="assets/css/login.css"/>
  </head>
  <body>
    <div id="header">
      <div class="part">
        <div id="logo">
          <img src="assets/images/logo.png" onclick="J.jump('index.html')"/>
        </div>
        <div class="head-left d-hide" onclick="J.open('http://www.theajack.site/jetterjs/')">
          Jetter.js
        </div>
        <div class="head-left d-hide" onclick="develop()">
          社区
        </div>
        <div class="head-left d-hide" onclick="develop()">
          留言板
        </div>
        
        <div class="head-right" id="setWrapper">
          <span class="glyphicon glyphicon-cog" id="set"></span>
        </div>
        <div class="head-right login">
          <span class="glyphicon glyphicon-user"></span>
          <span class="text">登录</span>
        </div>
        
        <div id="menuWrapper">
          <div class="menu-triangle"></div>
          <div class="menu-item regist">注册</div>
          <div class="menu-item user-center" onclick="develop()">个人中心</div>
          <div class="menu-item d-show" onclick="develop()">社区</div>
          <div class="menu-item d-show" onclick="develop()">留言板</div>
          <div class="menu-item logout">退出登录</div>
        </div>
      </div>
    </div>
    <div id="content" class="part clearfix">
      <div class="block" jet-form="title">
        <div id="title" jet-name="title">Title</div>
        <div class="i-info clearfix">
          <div class=" ii-block darker display-none" id="articleTop">
            <span class=" glyphicon glyphicon-eject"></span>
            <span>置顶</span>
          </div>
          <div class=" ii-block darker display-none"  id="articleStar">
            <span class=" glyphicon glyphicon-star"></span>
            <span>加精</span>
          </div>
          <div class=" ii-block">
            <span class=" glyphicon glyphicon-thumbs-up"></span>
            <span jet-name="prise_num" class="prise-num">0</span>
          </div>
          <div class=" ii-block">
            <span class=" glyphicon glyphicon-comment"></span>
            <span jet-name="comment_num" class="comment-num">0</span>
          </div>
          <div class=" ii-block">
            <span class=" glyphicon glyphicon-eye-open"></span>
            <span jet-name="watch_num" class="watch-num">0</span>
          </div>
          <div class="ii-block author d-hide">
            <span class=" glyphicon glyphicon-user"></span>
            <span jet-name="author">author</span>
          </div>
          <div class="ii-block time">
            <span class=" glyphicon glyphicon-calendar"></span>
            <span jet-name="date">date</span>
          </div>
        </div>
      </div>
      <div class="block">
        <div id="text">
<jh>description</jh>
<jh>keywords</jh>
<div class="section">
由于同源策略，一般来说位于a.com的网页无法与不是a.com的服务器沟通，
如果有这样的需求，就必须跨域，jsnop就是跨域数据访问的方式之一。
</div>
<div class="section">
jsnop是一种依靠开发人员的聪明才智创造出的一种非官方跨域数据交互协议，网上关于jsnop原理与优缺点的博客很多很多，本人也就不再一一赘述，
其实记住两点就好：
</div>
<div class="section"><span class="stress-bold">1.它是利用script标签实现跨域；</span></div>
<div class="section"><span class="stress-bold">2.它只支持get请求。</span></div>

<div class="section">
本人有跨域这个需求是在写github pages的时候，想在上面访问自己搭建的服务器上的数据，ajax在这个时候就无能为力了，于是本人学习了一下jsonp，
并把它封装到本人自娱自乐的<span class="link" onclick="J.open('http://www.theajack.site/jetterjs/')">jetterjs</span>类库中，该博客地址的数据访问用的就是这种技术。
</div>
<div class="section">
废话说的有点多了，接下来本人不才，尝试把我学习jsonp的过程一步一步还原一下。
</div>
<div class="title1">1.模拟跨域并简单跨域</div>
<div class="section">服务器端我使用的ASP.net,我用的是visual studio 2010(java也是同理，本人没有实践)，客户端就随便新建一个html文件就可以啦。以下是代码和图示：</div>
<div class="title2">1.服务器搭建</div>
<div class="image"><img src="assets/images/jsonp/1.png"/></div>
<div class="tip">1.打开visual studio，依次点击文件>新建>网站</div>
<div class="image"><img src="assets/images/jsonp/2.png"/></div>
<div class="tip">2.选择ASP.NET空网站，点击确定</div>
<div class="image"><img src="assets/images/jsonp/3.png"/></div>
<div class="tip">3.右击生成的网站，点击添加新项</div>
<div class="image"><img src="assets/images/jsonp/4.png"/></div>
<div class="tip">4.选择JScript文件，点击添加</div>
<div class="image"><img src="assets/images/jsonp/5.png"/></div>
<div class="tip">5.打开JScript.js文件，写入如下代码，保存</div>
<div class="code">
  <pre>
var user = {
    nickname="theajack",
    password="123456"
}
  </pre>
</div>
<div class="section">都做好保存之后，按F5启动网站，启动完成之后就不用管了，弹出来的页面也不要关闭。现在就相当于有一个localhost的服务器上面有一个user的数据，不过暂时先储存在js文件里，这么做是为了更深刻理解利用js跨域。接下来模拟另一台服务器的客户端。</div>
<div class="section">都做好保存之后，按F5启动网站，启动完成之后就不用管了，弹出来的页面也不要关闭。现在就相当于有一个localhost的服务器上面有一个user的数据，不过暂时先储存在js文件里，这么做是为了更深刻理解利用js跨域。接下来模拟另一台服务器的客户端。</div>
<div class="title2">2.新建客户端</div>
<div class="section">客户端极其简单，就是一个html文件：</div>
<div class="image"><img src="assets/images/jsonp/6.png"/></div>
<div class="tip">1.右击桌面，新建文本文档</div>
<div class="image"><img src="assets/images/jsonp/7.png"/></div>
<div class="tip">2.右击桌面，重命名为jsonp.html并保存</div>
<div class="image"><img src="assets/images/jsonp/8.png"/></div>
<div class="tip">3.打开刚启动的ASP.NET网站，复制地址栏的链接</div>
<div class="image"><img src="assets/images/jsonp/9.png"/></div>
<div class="tip">4.使用代码编辑工具或记事本打开，贴入如下代码，把下划线部分代码替换成你自己的链接，也就是复制好的链接+"JScript.js"</div>
<div class="code">
  <pre contenteditable="true" readonly="readonly" >
&lt;html&gt;
&lt;head&gt;&lt;head&gt;
&lt;body&gt;
&lt;/body&gt;
&lt;script src="<span class="link">http://localhost:37904/WebSite7/JScript.js</span>"&gt;&lt;/script&gt;
&lt;script&gt;
&#9;alert(user.nickname+" "+user.password);
&lt;/script&gt;
&lt;/html&gt;
  </pre>
</div>
<div class="section">
贴好之后不要忘记保存哦，然后就大功告成了！哈哈！让我们回到桌面，双击jsonp.html文件，或用浏览器打开它，结果如下，我们成功的把服务器端
的一个数据访问到了，由于html文件是在文件系统里打开的，而不是localhost，这就是跨域了，原理是不是一目了然，就是通过script标签来访问服务
器上的数据，当然这么简单的跨域我们是拒绝的，我们需要服务器动态处理我们的请求，并返回不同的结果，而不仅仅是简单调用一下服务器上的函数
或者变量，也就是说我们要用GET请求实现传参然后由服务器已回调函数的参数将结果传给客户端，不多废话了，直接上步骤:
</div>

<div class="title1">2.GET请求、回调传值</div>
<div class="title2">1.服务器改动</div>
<div class="section">
这次我们不需要服务器端的js文件了，我们直接请求
</div>


        </div>
        <div class="text-center">
          <span id="prise" onclick="prise()">
            <span class="glyphicon glyphicon-thumbs-up"></span>
            <span class="prise-num">0</span>
          </span>
        </div>
      </div>
  
      <div id="comment" class="block">
        <div class="block-title">评论</div>
        <div class="comment-toolbox clearfix">
          <div class="comment-tool c-face"><img src="assets/images/face.png"/></div>
          <div class="face-box">
            <!--代码加载内容-->
          </div>
          <div class="comment-tool c-link"><img src="assets/images/link.png"/></div>
          <div class="comment-tool c-image forbid"><img src="assets/images/image.png"/></div>
          <div class="comment-tool right button" onclick="comment()">提交</div>
        </div>
        <div contenteditable="true" jet-name="content" jet-get="html" class="comment"></div>
        <jh jet-name="u_id">1</jh>
        <jh jet-name="a_id"></jh>
        <jh jet-name="method">comment</jh>
      </div>
      <div id="commentList" class="block">
        <div class="block-title">评论列表</div>
        <!--代码加载内容-->
      </div>
      <div id="hot" class="block">
        <div class="block-title">最近热帖</div>
        <span class="link" onclick="J.open('https://github.com/theajack')">GitHub</span>
        <span class="link" onclick="J.open('https://github.com/theajack')">GitHub</span>
        <span class="link" onclick="J.open('https://github.com/theajack')">GitHub</span>
      </div>
      <div id="link" class="block ">
        <div class="block-title">友情链接</div>
        <span class="link" onclick="J.open('http://www.theajack.site/jetterjs/')">Jetter.js</span>
        <span class="link" onclick="J.open('http://www.theajack.site/')">个人主页</span>
        <span class="link" onclick="J.open('http://bikeshare.imwork.net')">人人单车</span>
        <span class="link" onclick="J.open('http://a.app.qq.com/o/simple.jsp?pkgname=com.main.theajack')">2048 plus</span>
        <span class="link" onclick="J.open('http://a.app.qq.com/o/simple.jsp?pkgname=com.example.stonefinance')">石头理财</span>
        <span class="link" onclick="J.show('In developing')">突破防线</span>
        <span class="link" onclick="J.open('http://www.theajack.site/maze/')">迷宫</span>
        <span class="link" onclick="J.open('http://www.theajack.site/bombbattle/')">炸弹大作战</span>
        <span class="link" onclick="J.open('http://www.theajack.site/bike/')">人人单车纯净版</span>
      </div>
    </div>
    <div id="footer">
      <div id="footerLink">
        <span class="link" onclick="J.open('https://github.com/theajack')">GitHub</span>
        <span class="split-icon">|</span>
        <span class="link" onclick="J.open('http://weibo.com/p/1005055304330572/home?from=page_100505&mod=TAB&is_all=1')">Sina Micro-blog</span>
        <span class="split-icon">|</span>
        
        <span class="wechat-public d-hide">WeChat Official Accounts<img class="wechat-img" src="assets/images/wechat_qrcode.jpg"/></span>
        <span class="split-icon d-hide">|</span>
        
        Email:theajack@qq.com
        <div class=" d-show">
          <span class="wechat-public">
            WeChat Official Accounts
            <img class="wechat-img" src="assets/images/wechat_qrcode.jpg"/>
          </span>
        </div>
      </div>
      <div id="copyright">
        <span class="glyphicon glyphicon-copyright-mark"></span> 2016 TheaJack All rights reserved
      </div>
    </div>
    <div id="allComment" class="cover display-none" onclick="closeAllComment()">
      <div  class="block cover-block" onclick="stopBubble(event)">
        <div class=" block-title">全部评论
          <span class="glyphicon glyphicon-remove cover-close" onclick="closeAllComment()"></span>
        </div>
        <div id="allCommentList"></div>
      </div>
    </div>
    
    <div id="floatComment" class="cover display-none" onclick="closeCover(this)">
      <div class="block cover-block" onclick="stopBubble(event)">
        <div class="block-title">回复 : 
          <span class="reply-nickname"></span>
          <span class="glyphicon glyphicon-remove cover-close" onclick="closeCover(this.parent(3))"></span>
        </div>
        <div class="comment-toolbox clearfix">
          <div class="comment-tool c-face"><img src="assets/images/face.png"/></div>
          <div class="face-box">
            <!--代码加载内容-->
          </div>
          <div class="comment-tool c-link"><img src="assets/images/link.png"/></div>
          <div class="comment-tool c-image forbid"><img src="assets/images/image.png"/></div>
          <div class="comment-tool right button" onclick="reply()">提交</div>
          <jh jet-name="bc_id"></jh>
          <jh jet-name="u_id">1</jh>
          <jh jet-name="method">replyComment</jh>
        </div>
        <div contenteditable="true" jet-name="content" jet-get="html" class="comment"></div>
      </div>
    </div>
    
    
    <script src="assets/js/jetter.min.js"></script>
    <script src="assets/js/common.js"></script>
    <script src="assets/js/login.js"></script>
    <script src="assets/js/article.js"></script>
    <script src="assets/js/articleData.js"></script>
  </body>
</html>
